<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Result Viewer</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body{font-family:'Roboto',sans-serif;background-color:#121212;color:#e0e0e0;text-align:center;padding:20px;margin:0}
        #app{background:#1e1e1e;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,0.3);padding:30px;max-width:500px;margin:auto;transition:transform .2s}
        #app:hover{transform:scale(1.02)}
        h1{font-size:28px;margin-bottom:10px;color:#ff6b81}
        p{font-size:16px;margin-bottom:20px;color:#b0bec5}
        label{font-weight:bold;margin-top:10px;display:block;color:#ff6b81}
        input,button{padding:12px;margin:10px 0;width:100%;max-width:350px;border:2px solid #ff6b81;border-radius:6px;font-size:16px;background-color:#2c2c2c;color:#e0e0e0;transition:border-color .3s}
        input:focus{outline:none;border-color:#ff3b57}
        button{background-color:#ff6b81;color:white;cursor:pointer;border:none;font-weight:bold}
        button:hover{background-color:#ff3b57}
        #results-frame{margin-top:20px;border:2px solid #ff6b81;border-radius:6px;padding:15px;max-height:300px;overflow-y:auto;text-align:left;background-color:#2c2c2c;color:#e0e0e0}
        .loading-spinner{display:none;text-align:center;margin-top:10px}
        .spinner{width:40px;height:40px;border:4px solid #ccc;border-top:4px solid #ff6b81;border-radius:50%;animation:spin 1s linear infinite}
        @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
        #warning-popup{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#1e1e1e;border:2px solid #ff6b81;border-radius:10px;padding:20px;z-index:1000;color:#e0e0e0}
        #overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:999}
        button.close-popup{background:#ff3b57;color:white;border:none;padding:10px;border-radius:5px;cursor:pointer;}
        button.close-popup:hover{background:#ff6b81;}
        @media(max-width:600px){#app{padding:20px}h1{font-size:24px}}
    </style>
</head>
<body>
    <script>
        document.write(`
        <div id="app">
            <h1>View Student Results</h1>
            <p>Only For 9<sup>th</sup> Standard</p>
            <form id="result-form">
                <label for="gr-num">Enter Gr_num:</label>
                <input type="text" id="gr-num" placeholder="Enter Gr_num" required pattern="[A-Za-z0-9]{5,10}" title="5 to 10 alphanumeric characters">
                <button id="submit-btn">Get Results</button>
            </form>
            <div class="loading-spinner" id="loading-spinner">
                <p>Fetching results...</p>
                <div class="spinner"></div>
            </div>
            <div id="results-frame" role="alert" aria-live="polite"></div>
        </div>
        <div id="overlay"></div>
      <div id="warning-popup">
    <h2>Warning!</h2>
    <p>This site may contain sensitive information. Use at your own risk. Misuse of this site can lead to:</p>
    <ul style="text-align: left;">
        <li>Privacy violations and potential legal consequences.</li>
        <li>Spreading misinformation that can harm students and families.</li>
        <li>Facilitating cyberbullying and harassment.</li>
        <li>Data breaches resulting in severe penalties.</li>
        <li>Academic dishonesty that undermines educational integrity.</li>
    </ul>
    <p>Proceeding may expose you to unexpected results and information that is not suitable for all audiences.</p>
    <p><strong>Important Tips:</strong></p>
    <ul style="text-align: left;">
        <li>This site uses the school server to access student data.</li>
        <li>Your IP address: "<span id="user-ip"></span>" will be logged and may be visible to the school server</li>
        <li>Always use your own credentials and respect the privacy of others.</li>
        <li>Avoid sharing sensitive information on this platform.</li>
    </ul>
    <button class="close-popup" onclick="closePopup()">Close</button>
</div>


        `);

        function fetchUserIP() {
    fetch('https://api.ipify.org?format=json')
        .then(response => response.json())
        .then(data => {
            document.getElementById('user-ip').innerText = data.ip;
        })
        .catch(error => {
            console.error('Error fetching IP address:', error);
            document.getElementById('user-ip').innerText = 'Unable to retrieve IP';
        });
}

// Call this function when the pop-up is shown
fetchUserIP();

        
        const resultsCache = {};
        document.addEventListener('DOMContentLoaded', () => {
            // Show warning pop-up on load
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('warning-popup').style.display = 'block';

            document.getElementById('submit-btn').addEventListener('click', (event) => {
                event.preventDefault();
                const grNum = document.getElementById('gr-num').value.trim();
                const resultsFrame = document.getElementById('results-frame');
                const loadingSpinner = document.getElementById('loading-spinner');

                loadingSpinner.style.display = 'block';
                resultsFrame.innerHTML = 'Loading...';

                if (resultsCache[grNum]) {
                    resultsFrame.innerHTML = `<h2>Results:</h2><div>${resultsCache[grNum]}</div>`;
                    loadingSpinner.style.display = 'none';
                    return;
                }

                fetch(`https://dextroexam.com/STFRANCISB/API/profile.php?Gr_num=${grNum}`)
                    .then(response => {
                        if (!response.ok) throw new Error('Network response was not ok: ' + response.statusText);
                        return response.json();
                    })
                    .then(data => {
                        const std = data.data.Std;
                        const sec = data.data.Section;

                        if (std !== 'ninth') {
                            resultsFrame.innerText = `Results are only available for 9th standard students.`;
                            return;
                        }

                        if (sec) {
                            let examId = '';
                            switch (sec) {
                                case 'D': examId = '1173,1193,1203,1213'; break;
                                case 'C': examId = '1172,1192,1202,1212'; break;
                                case 'A': examId = '1170,1190,1200,1210'; break;
                                case 'B': examId = '1171,1191,1201,1211'; break;
                                default: resultsFrame.innerText = `Section not recognized. Check the Gr_num: ${grNum}`; return;
                            }

                            const resultsUrl = `https://dextroexam.com/STFRANCISB/dextro2425/Admin/school/printAllresult.php?mdm=English&std=${std}&sec=${sec}&examId=${examId}&result_date=&reopen_date=&attendance=107&examgroup=&gr_num=${grNum}`;
                            return fetch(resultsUrl);
                        } else {
                            resultsFrame.innerText = `Std or Section not found. Check the Gr_num: ${grNum}`;
                            return Promise.reject(new Error('Std or Section not found'));
                        }
                    })
                    .then(response => {
                        if (!response.ok) throw new Error('Error fetching results: ' + response.statusText);
                        return response.text();
                    })
                    .then(resultsData => {
                        resultsFrame.innerHTML = `<h2>Results:</h2><div>${resultsData}</div>`;
                        resultsCache[grNum] = resultsData;
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        resultsFrame.innerText = 'Error fetching results. Please try again later.';
                    })
                    .finally(() => {
                        loadingSpinner.style.display = 'none';
                    });
            });
        });

        function closePopup() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('warning-popup').style.display = 'none';
        }
    </script>
</body>
</html>
